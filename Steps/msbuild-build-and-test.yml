parameters:
  - name: ProjectOrSolutionPath
    type: string
  - name: Major
    type: number
    default: 1
  - name: Minor
    type: number
    default: 0
  - name: Configuration
    type: string
    default: Release
    values:
      - Debug
      - Release

steps:
  - template: /Steps/download-private-signing-key.yml

  - template: /Steps/dotnet-restore.yml
    parameters:
      ProjectOrSolutionPath: ${{ parameters.ProjectOrSolutionPath }}

  - task: MSBuild@1
    displayName: msbuild (${{ parameters.Configuration }})
    inputs:
      solution: "${{ parameters.ProjectOrSolutionPath }}"
      configuration: "${{ parameters.Configuration }}"
      msbuildArguments: "/property:Major=${{ parameters.Configuration }};Minor=${{ parameters.Minor }};Build=$(VersionBuild);Revision=$(VersionRevision);AssemblyOriginatorKeyFile=$(privateSigningKey.secureFilePath);GeneratePackageOnBuild=false"
      clean: true  

  - template: /Steps/dotnet-test.yml
    parameters:
      ProjectOrSolutionPath: ${{ parameters.ProjectOrSolutionPath }}
      Configuration: ${{ parameters.Configuration }}